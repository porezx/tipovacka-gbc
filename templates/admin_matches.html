{% extends "base.html" %}

{% block title %}SprÃ¡va zÃ¡pasÅ¯{% endblock %}

{% block content %}
<h1>SprÃ¡va zÃ¡pasÅ¯</h1>

<h2>DÃ¡vkovÃ© nahrÃ¡nÃ­ zÃ¡pasÅ¯ (XLSX)</h2>
<form method="post" action="/admin/matches" enctype="multipart/form-data" style="margin-bottom: 2em;">
    <input type="hidden" name="action" value="import">

    <label>SoutÄ›Å¾:</label>
    <select name="competition_id" required>
        {% for competition in competitions %}
            <option value="{{ competition.id }}">{{ competition.name }}</option>
        {% endfor %}
    </select>

    <label>Soubor (.xlsx):</label>
    <input type="file" name="match_file" accept=".xlsx" required>

    <button type="submit">ğŸ“‚ Importovat zÃ¡pasy</button>
</form>

<p><strong>OÄekÃ¡vanÃ½ formÃ¡t XLSX:</strong></p>
<pre>
Sloupce: DATUM, ÄŒAS, ZÃPAS, (hostujÃ­cÃ­ tÃ½m ve sloupci bez nÃ¡zvu), ÃšroveÅˆ (nepovinnÄ›)

PÅ™Ã­klad Å™Ã¡dku:
9. kvÄ›tna | 16:20 | Rakousko | Finsko | ZÃ¡kladnÃ­ skupina
</pre>

<h2>PÅ™idat novÃ½ zÃ¡pas</h2>
<form method="post" action="/admin/matches" style="margin-bottom: 2em;">
    <input type="hidden" name="action" value="add">

    <label>Datum a Äas:</label>
    <input type="datetime-local" name="match_time" required>

    <label>DomÃ¡cÃ­:</label>
    <input type="text" name="team_home" required>

    <label>HostÃ©:</label>
    <input type="text" name="team_away" required>

    <label>SoutÄ›Å¾:</label>
    <select name="competition_id" required>
        {% for competition in competitions %}
            <option value="{{ competition.id }}">{{ competition.name }}</option>
        {% endfor %}
    </select>

    <label>ÃšroveÅˆ:</label>
    <select name="match_level_id">
        <option value="">-- Å¾Ã¡dnÃ¡ --</option>
        {% for level in all_levels %}
            <option value="{{ level.id }}">{{ level.name }} ({{ level.base_points }}b)</option>
        {% endfor %}
    </select>

    <button type="submit">â• PÅ™idat zÃ¡pas</button>
</form>

<h2>ExistujÃ­cÃ­ zÃ¡pasy podle soutÄ›Å¾e</h2>

{% for competition, matches in matches_by_competition.items() %}
    <h3>{{ competition.name }} (ID {{ competition.id }})</h3>

    {% for match in matches %}
        {% set index = loop.index %}
        <form method="post" action="/admin/matches" style="margin-bottom: 1em; border-bottom: 1px solid #ccc; padding-bottom: 0.5em;">
            {{ index }}.&nbsp;&nbsp;
            <input type="hidden" name="match_id" value="{{ match.id }}">

            <label>Datum a Äas:</label>
            <input type="datetime-local" name="match_time"
                   value="{{ match.match_time.strftime('%Y-%m-%dT%H:%M') if match.match_time else '' }}" required>

            <label>DomÃ¡cÃ­:</label>
            <input type="text" name="team_home" value="{{ match.team_home }}" required>

            <label>HostÃ©:</label>
            <input type="text" name="team_away" value="{{ match.team_away }}" required>

            <label>ÃšroveÅˆ:</label>
            <select name="match_level_id">
                <option value="">-- Å¾Ã¡dnÃ¡ --</option>
                {% for level in levels_by_competition[competition.id] %}
                    <option value="{{ level.id }}" {% if match.match_level_id == level.id %}selected{% endif %}>
                        {{ level.name }}
                    </option>
                {% endfor %}
            </select>

            <button type="submit" name="action" value="update" style="margin-top: 0.5em;">ğŸ’¾ UloÅ¾it</button>
            <button type="submit" name="action" value="delete" style="margin-top: 0.5em; margin-left: 1em;">ğŸ—‘ï¸ Smazat</button>
        </form>
    {% endfor %}
{% endfor %}
{% endblock %}
